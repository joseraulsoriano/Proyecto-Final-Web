<div class="post-detail-container">
  <div class="post-header">
    <button routerLink="/dashboard" class="btn-back">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
      Volver
    </button>
  </div>

  @if (loading) {
    <div class="loading">Cargando post...</div>
  } @else if (error) {
    <div class="error-alert">{{ error }}</div>
  } @else if (post && user) {
    <div class="post-content">
      <div class="post-header-section">
        <div class="post-category-badge">
          <span class="badge">{{ post.category.name }}</span>
        </div>
        <div class="post-actions">
          @if (canEdit) {
            <a [routerLink]="['/posts', post.id, 'edit']" class="btn-icon btn-edit" title="Editar">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </a>
            <button class="btn-icon btn-danger" (click)="openDeleteModal()" title="Eliminar">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          } @else {
            <button class="btn-icon btn-report" (click)="openReportModal()" title="Reportar">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                <line x1="4" y1="22" x2="4" y2="15"></line>
              </svg>
            </button>
          }
        </div>
      </div>

      <h1 class="post-title">{{ post.title }}</h1>

      <div class="post-meta">
        <div class="author-info">
          <span class="author-name">{{ post.author.full_name }}</span>
          <span class="post-date">{{ formatDate(post.created_at) }}</span>
        </div>
        @if (post.tags.length > 0) {
          <div class="post-tags">
            @for (tag of post.tags; track tag.id) {
              <span class="tag">{{ tag.name }}</span>
            }
          </div>
        }
      </div>

      <div class="post-body">
        <p>{{ post.content }}</p>
      </div>
    </div>

    <!-- Componente de comentarios -->
    <app-comments-list 
      [postId]="post.id"
      [user]="user"
      [canEdit]="canEdit">
    </app-comments-list>
  }

  <!-- Modales -->
  <app-confirm-delete-post
    [isOpen]="showDeleteModal"
    [postTitle]="post?.title || ''"
    (confirm)="confirmDelete()"
    (cancel)="closeDeleteModal()">
  </app-confirm-delete-post>

  <app-report-post
    [isOpen]="showReportModal"
    [postId]="post?.id || null"
    (close)="closeReportModal()"
    (reported)="onReported()">
  </app-report-post>
</div>


